import{i as t,a as i,m as s,n,o as a,c as e,f as o,p as r,w as l,q as h,at as d,g as p,v as c,x as g,_ as u}from"../../assets/app.2DJL4jsJ.js";import{A as m}from"../index/index.sBZz26mU.js";L.AnimatedMarker=L.Marker.extend({options:{speetX:1,speedList:[],distance:100,interval:100,autoStart:!1,isPlay:!1,playCall:null},initialize:function(t,i){Object.assign(this.options,i),this.isZooming=!1,L.Marker.prototype.initialize.call(this,t[0],i),this.setLine(t),this.resetIcon()},resetIcon:function(){const t=this;var i=t.options.icon.options,s=L.DivIcon.extend({createIcon:function(){var s=document.createElement("div");s.style.width=i.iconSize[0]+"px",s.style.height=i.iconSize[1]+"px",s.style.position="absolute",t.div=document.createElement("div"),t.div.style.width=i.iconSize[0]+"px",t.div.style.height=i.iconSize[1]+"px",t.div.style.transition="transform linear 100ms",t.div.style.transformOrigin="center",t.div.style.transform="translate3d(-"+i.iconAnchor[0]+"px, -"+i.iconAnchor[0]+"px, 0) rotate(-"+t._latlngs[0].bearing+"deg)";const n=document.createElement("img");return n.src=i.iconUrl,n.width=i.iconSize[0],n.height=i.iconSize[1],t.div.appendChild(n),s.appendChild(t.div),s},rotate(i){t.before&&Math.abs(t.before-i)>=180?t.div.style.transition="none":t.div.style.transition="transform linear 100ms",t.div.style.transform="translate3d(-19px, -13px, 0) rotate(-"+i+"deg)",t.before=i},iconSize:i.iconSize});this.icon=new s,this.setIcon(this.icon)},onAdd:function(t){L.Marker.prototype.onAdd.call(this,t),this.animate(),this.map=t;const i=this;t.addEventListener("zoomstart",(function(){i.isZooming=!0})),t.addEventListener("zoomend",(function(){i.isZooming=!1})),this.options.autoStart&&this.start()},animate:function(){var t=Date.now();if(t<this.startedAt+this.duration&&this.getLatLng().distanceTo(this.startLatLng)<this.nextLatLng.distanceTo(this.startLatLng)?this.isPlay&&requestAnimationFrame(this.animate.bind(this)):this._i<this._latlngs.length-1&&(this.speetChange&&(this._latlngs=this._latlngsnew,this.speetChange=!1),this.startedAt=Date.now(),this.startLatLng=this._latlngs[this._i],this.nextLatLng=this._latlngs[this._i+1],this.duration=this.startLatLng.duration,this.setLatLng(this._latlngs[this._i]),this.icon.rotate(this.startLatLng.bearing),this._i++,this.isPlay&&requestAnimationFrame(this.animate.bind(this))),!this.isZooming&&this.map){var i=t-this.startedAt;i>this.duration&&(i=this.duration);var s=this.startLatLng.lat+(this.nextLatLng.lat-this.startLatLng.lat)/this.startLatLng.duration*i,n=this.startLatLng.lng+(this.nextLatLng.lng-this.startLatLng.lng)/this.startLatLng.duration*i;this.setLatLng({lat:s,lng:n}),this.options.playCall&&this.options.playCall({lat:s,lng:n})}},setSpeetX:function(t){var i=t/this.options.speetX;this._latlngsnew=[];for(var s=0;s<this._latlngs.length;s++){var n=L.latLng(this._latlngs[s].lat,this._latlngs[s].lng);n.duration=this._latlngs[s].duration/i,n.bearing=this._latlngs[s].bearing,this._latlngsnew.push(n)}this.options.speetX=t,this.speetChange=!0},start:function(){this.isPlay=!0,this.startedAt=Date.now(),this.isPause&&(this.startedAt=this.startedAt-this.playedTime,this.isPause=!1),this.animate()},pause:function(){this.playedTime=Date.now()-this.startedAt,this.isPause=!0,this.isPlay=!1},stop:function(){this.isPlay=!1,this.isPause=!1,this.startedAt=NaN,this._i=0,this.animate()},setLine:function(t){for(var i=0;i<t.length;i++)i===t.length-1?(t[i].duration=t[i-1].duration,t[i].bearing=t[i-1].bearing):(this.options.speedList.length>0&&void 0!==this.options.speedList[i]?t[i].duration=t[i].distanceTo(t[i+1])/this.options.distance*(this.options.interval/this.options.speedList[i]):t[i].duration=t[i].distanceTo(t[i+1])/this.options.distance*this.options.interval,t[i].bearing=this.getRotation(t[i],t[i+1]));this._latlngs=t,this._i=0},getRotation:function(t,i){var s=i.lng-t.lng,n=i.lat-t.lat,a=180*Math.atan2(n,s)/Math.PI;return a>-180&&a<0&&(a=360+a),a}}),L.animatedMarker=function(t,i){return new L.AnimatedMarker(t,i)};const y={class:"top-bar"},f=(t=>(c("data-v-88adb056"),t=t(),g(),t))((()=>o("div",{id:"map"},null,-1))),v=u(t({__name:"index",setup(t){let c,g,u,L=null;function v(t){g.push(t),c.setLatLngs(g)}let _=1;function b(){_*=2,u.setSpeetX(_)}function x(){_/=2,u.setSpeetX(_)}function A(){u.start()}function S(){u.pause()}function w(){g=[],u.stop()}return i((()=>{(()=>{L=d.map("map",{crs:d.CRS.EPSG3857,center:[39.924317,116.390619],zoom:12,preferCanvas:!0}),d.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{noWrap:!0,attribution:m}).addTo(L);const t=d.polyline([[39.898457,116.391844],[39.898595,116.377947],[39.898341,116.368001],[39.898063,116.357144],[39.899095,116.351934],[39.905871,116.35067],[39.922329,116.3498],[39.931017,116.349671],[39.939104,116.349225],[39.942233,116.34991],[39.947263,116.366892],[39.947568,116.387537],[39.947764,116.401988],[39.947929,116.410824],[39.947558,116.42674],[39.9397,116.427338],[39.932404,116.427919],[39.923109,116.428377],[39.907094,116.429583],[39.906858,116.41404],[39.906622,116.405321],[39.906324,116.394954],[39.906308,116.391264],[39.916611,116.390748]],{weight:8}).addTo(L);c=d.polyline([],{weight:8,color:"#FF9900"}).addTo(L),d.polylineDecorator(t,{patterns:[{repeat:50,symbol:d.Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:2,color:"#FFFFFF"}})}]}).addTo(L);const i=d.icon({iconSize:[37,26],iconAnchor:[19,13],iconUrl:"/image/car.png"});u=d.animatedMarker(t.getLatLngs(),{speedList:[1,1,2,2,3,3,3,4,4,4,4,4,4,5,5,4,4,4,3,2,2,1,1,1],interval:200,icon:i,playCall:v}).addTo(L),g=[t.getLatLngs()[0]]})()})),s((()=>{L&&(L.remove(),L=null)})),(t,i)=>{const s=n("el-button");return a(),e(h,null,[o("div",y,[r(s,{type:"primary",onClick:A},{default:l((()=>[p("开始")])),_:1}),r(s,{type:"primary",onClick:S},{default:l((()=>[p("暂停")])),_:1}),r(s,{type:"primary",onClick:b},{default:l((()=>[p("加速")])),_:1}),r(s,{type:"primary",onClick:x},{default:l((()=>[p("减速")])),_:1}),r(s,{type:"primary",onClick:w},{default:l((()=>[p("停止")])),_:1})]),f],64)}}}),[["__scopeId","data-v-88adb056"]]);export{v as default};
